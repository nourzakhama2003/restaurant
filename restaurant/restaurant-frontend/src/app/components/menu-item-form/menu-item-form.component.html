<div class="menu-item-form-container">
    <!-- Form Header -->
    <div class="form-header">
        <div class="form-title-section">
            <mat-icon class="form-icon">{{ menuItem ? 'edit' : 'add' }}</mat-icon>
            <h2>{{ menuItem ? 'Modifier le Plat' : 'Nouveau Plat' }}</h2>
        </div>
        <button class="close-btn" (click)="dialogRef.close()">
            <mat-icon>close</mat-icon>
        </button>
    </div>

    <!-- Form Content -->
    <form [formGroup]="form" (ngSubmit)="submit()" class="menu-item-form">
        <div class="form-content">
            <!-- Restaurant Selection -->
            <div class="form-field-card" *ngIf="!restaurantId">
                <label class="field-label">
                    <mat-icon>restaurant</mat-icon>
                    Restaurant *
                </label>
                <div class="restaurant-search-container">
                    <input class="form-input" formControlName="restaurantSearch" placeholder="Rechercher un restaurant..." (input)="filterRestaurants()" required />
                    <div class="restaurant-dropdown" *ngIf="filteredRestaurants.length > 0 && showRestaurantDropdown">
                        <div class="restaurant-option" *ngFor="let restaurant of filteredRestaurants" (click)="selectRestaurant(restaurant)">
                            <div class="restaurant-image">
                                <img [src]="getRestaurantImage(restaurant)" [alt]="restaurant.name" />
                            </div>
                            <span>{{ restaurant.name }}</span>
                        </div>
                    </div>
                </div>
                <div class="error-message" *ngIf="form.get('restaurantId')?.hasError('required') && form.get('restaurantId')?.touched">
                    Le restaurant est requis
                </div>
                <div class="error-message" *ngIf="restaurantSearch && !isRestaurantSelected()">
                    Veuillez sélectionner un restaurant dans la liste
                </div>
            </div>

            <!-- Menu Item Name -->
            <div class="form-field-card">
                <label class="field-label">
                    <mat-icon>restaurant_menu</mat-icon>
                    Nom du plat *
                </label>
                <input class="form-input" formControlName="name" placeholder="ex: Pizza Margherita" required />
                <div class="error-message" *ngIf="form.get('name')?.hasError('required') && form.get('name')?.touched">
                    Le nom du plat est requis
                </div>
                <div class="error-message" *ngIf="form.get('name')?.hasError('minlength') && form.get('name')?.touched">
                    Le nom doit contenir au moins 2 caractères
                </div>
            </div>

            <!-- Category Selection -->
            <div class="form-field-card">
                <label class="field-label">
                    <mat-icon>category</mat-icon>
                    Catégorie *
                </label>
                <select class="form-select" formControlName="categoryId" required>
                    <option value="">Choisir une catégorie</option>
                    <option *ngFor="let cat of categories" [value]="cat.id">
                        {{ cat.name }}
                    </option>
                </select>
                <div class="error-message" *ngIf="form.get('categoryId')?.hasError('required') && form.get('categoryId')?.touched">
                    La catégorie est requise
                </div>
            </div>

            <!-- Description -->
            <div class="form-field-card">
                <label class="field-label">
                    <mat-icon>description</mat-icon>
                    Description
                </label>
                <textarea class="form-textarea" formControlName="description" placeholder="Décrivez ce plat..." rows="4"></textarea>
            </div>

            <!-- Price -->
            <div class="form-field-card">
                <label class="field-label">
             
                    Prix *
                </label>
                <div class="price-input-container">
                    <input class="form-input" type="number" formControlName="price" placeholder="0.00" min="0" step="0.01" required />
                    <span class="price-suffix">TND</span>
                </div>
                <div class="error-message" *ngIf="form.get('price')?.hasError('required') && form.get('price')?.touched">
                    Le prix est requis
                </div>
                <div class="error-message" *ngIf="form.get('price')?.hasError('min') && form.get('price')?.touched">
                    Le prix doit être positif
                </div>
            </div>

            <!-- Image Upload -->
            <div class="form-field-card">
                <label class="field-label">
                    <mat-icon>image</mat-icon>
                    Image du plat
                </label>
                <div class="image-upload-section">
                    <div class="current-image" *ngIf="imageBase64">
                        <img [src]="imageBase64" alt="Image du plat" />
                        <button type="button" class="remove-image-btn" (click)="removeImage()" matTooltip="Supprimer l'image">
                            <mat-icon>close</mat-icon>
                        </button>
                    </div>

                    <div class="upload-area" *ngIf="!imageBase64">
                        <input id="itemImageUpload" type="file" accept="image/*" (change)="onImageSelected($event)" class="hidden-input">
                        <label for="itemImageUpload" class="upload-label">
                            <mat-icon class="upload-icon">cloud_upload</mat-icon>
                            <span class="upload-text">Cliquez pour ajouter une image</span>
                            <span class="upload-hint">PNG, JPG jusqu'à 5MB</span>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
            <button type="button" class="cancel-btn" (click)="dialogRef.close()">
                <mat-icon>close</mat-icon>
                Annuler
            </button>
            <button type="submit" class="submit-btn" [disabled]="form.invalid || isSubmitting">
                <mat-icon *ngIf="!isSubmitting">{{ menuItem ? 'save' : 'add' }}</mat-icon>
                <div *ngIf="isSubmitting" class="spinner"></div>
                {{ isSubmitting ? 'Enregistrement...' : (menuItem ? 'Mettre à jour' : 'Créer') }}
            </button>
        </div>
    </form>
</div>