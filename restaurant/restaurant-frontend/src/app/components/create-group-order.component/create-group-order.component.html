<div class="create-order-bg">
    <div class="create-order-wrapper">
        <mat-card class="glass-card">
            <mat-card-header>
                <mat-card-title>
                    <span class="title-icon"><mat-icon>group_add</mat-icon></span>
                    <span>Créer une commande groupée</span>
                </mat-card-title>

            </mat-card-header>
            <mat-card-content>
                <form [formGroup]="groupOrderForm" (ngSubmit)="onSubmit()" class="modern-form">
                    

                    <div class="form-row">
                        <label for="restaurantSearch">rechercher Restaurant</label>
                        <input id="restaurantSearch" type="text" class="Input " formControlName="restaurantSearch" [matAutocomplete]="auto" placeholder="Tapez le nom du restaurant ou le type de cuisine..." required>
                        <mat-autocomplete #auto="matAutocomplete" (optionSelected)="onRestaurantSelected($event.option.value)" [displayWith]="displayRestaurantFn">
                            <mat-option *ngFor="let restaurant of filteredRestaurants | async" [value]="restaurant">
                                <div class="restaurant-option">
                                    <div class="restaurant-name">{{restaurant.name}}</div>
                                    <div class="restaurant-cuisine">{{restaurant.cuisineType || 'Aucun type de cuisine'}}</div>
                                </div>
                            </mat-option>
                        </mat-autocomplete>
                        <div class="error" *ngIf="groupOrderForm.get('restaurantSearch')?.value && !isRestaurantSelected()">
                            Veuillez sélectionner un restaurant dans la liste
                        </div>
                    </div>

                    <div class="form-row">
                        <label for="deliveryFee">Frais de livraison</label>
                        <input id="deliveryFee" class="Input" type="number" min="0" formControlName="deliveryFee" placeholder="Saisir le montant en TND" required>
                        <div class="hint">Ce montant sera partagé entre tous les participants</div>
                        <div class="error" *ngIf="groupOrderForm.get('deliveryFee')?.hasError('min')">
                            Le frais de livraison ne peut pas être négatif
                        </div>
                    </div>

                    <div class="form-row deadline-row">
                        <label for="orderDeadlineTime">Heure de clôture des commandes</label>
                        <div class="relative"><input id="orderDeadlineDate" class="Input" [matDatepicker]="picker" formControlName="orderDeadlineDate" required>
                            <mat-datepicker-toggle class="absolute top-0 right-0" matSuffix [for]="picker"></mat-datepicker-toggle>
                            <mat-datepicker #picker></mat-datepicker>
                        </div>
                        <div class="hint">Date à laquelle la participation aux commandes se termine</div>
                        <div class="error" *ngIf="groupOrderForm.get('orderDeadlineDate')?.hasError('required')">
                            La date de clôture est requise
                        </div>

                        <input id="orderDeadlineTime" class="Input" type="time" formControlName="orderDeadlineTime" required>
                        <div class="hint">Heure à laquelle la participation aux commandes se termine</div>
                        <div class="error" *ngIf="groupOrderForm.get('orderDeadlineTime')?.hasError('required')">
                            L'heure de clôture est requise
                        </div>
                    </div>
                    <div class="form-row deadline-progress-row" *ngIf="groupOrderForm.get('orderDeadlineDate')?.value && groupOrderForm.get('orderDeadlineTime')?.value">
                        <mat-progress-bar mode="determinate" [value]="isDeadlineValid ? 100 : 30" color="primary"></mat-progress-bar>
                        <div class="deadline-feedback" [ngClass]="{'valid': isDeadlineValid, 'invalid': !isDeadlineValid}">
                            <mat-icon>{{isDeadlineValid ? 'check_circle' : 'warning'}}</mat-icon>
                            <span>{{isDeadlineValid ? 'La date limite est valide - la commande sera créée avec succès' : deadlineValidationMessage}}</span>
                        </div>
                    </div>
                </form>
            </mat-card-content>
            <mat-card-actions align="end">
                <button mat-stroked-button color="warn" (click)="onCancel()" type="button">
          <mat-icon>close</mat-icon> Annuler
        </button>
                <button mat-raised-button color="primary" (click)="onSubmit()" [disabled]="groupOrderForm.invalid || isLoading || !isDeadlineValid || !isRestaurantSelected()">
          <mat-icon>add_circle</mat-icon> {{isLoading ? 'Création...' : 'Créer la commande groupée'}}
              </button>
            </mat-card-actions>
        </mat-card>
    </div>
</div>