<div class="categories-container">
    <!-- Header Section -->
    <div class="categories-header">
        <div class="header-content">
            <div class="header-title-section">
                <div class="title-icon">
                    <mat-icon>category</mat-icon>
                </div>
                <div class="title-content">
                    <h1 class="page-title">Gestion des Catégories</h1>
                    <p class="page-subtitle">Organisez vos menus par catégories</p>
                </div>
            </div>
            <button class="add-category-btn" (click)="editingCategory = null; form.reset(); showForm = true;">
                <mat-icon>add</mat-icon>
                <span>Nouvelle Catégorie</span>
            </button>
        </div>
    </div>

    <!-- Search and Filter Section -->
    <div class="search-filter-section">
        <div class="search-container">
            <div class="search-input-wrapper">
                <mat-icon class="search-icon">search</mat-icon>
                <input type="text" class="search-input" placeholder="Rechercher une catégorie..." [(ngModel)]="searchTerm" (input)="filterCategories()" />
                <button *ngIf="searchTerm" class="clear-search-btn" (click)="clearSearch()" mat-icon-button>
                    <mat-icon>close</mat-icon>
                </button>
            </div>
        </div>
        <div class="filter-info" *ngIf="searchTerm">
            <mat-icon>filter_list</mat-icon>
            <span>{{ filteredCategories.length }} catégorie(s) trouvée(s)</span>
        </div>
    </div>

    <!-- Categories Grid -->
    <div class="categories-content">
        <div *ngIf="isLoading" class="loading-state">
            <mat-spinner diameter="40"></mat-spinner>
            <p>Chargement des catégories...</p>
        </div>

        <div *ngIf="!isLoading && filteredCategories.length === 0" class="empty-state">
            <div class="empty-icon">
                <mat-icon>category</mat-icon>
            </div>
            <h3>Aucune catégorie trouvée</h3>
            <p *ngIf="searchTerm">Aucune catégorie ne correspond à votre recherche.</p>
            <p *ngIf="!searchTerm">Commencez par créer votre première catégorie.</p>
            <button *ngIf="!searchTerm" class="create-first-btn" (click)="editingCategory = null; form.reset(); showForm = true;">
                <mat-icon>add</mat-icon>
                Créer la première catégorie
            </button>
        </div>

        <div *ngIf="!isLoading && filteredCategories.length > 0" class="categories-grid">
            <div class="category-card" *ngFor="let cat of filteredCategories; let i = index" [@fadeInUp] [style.animation-delay]="(i * 100) + 'ms'">
                <div class="card-header">
                    <div class="category-avatar">
                        <img [src]="getImageForCategory(cat)" [alt]="cat.name" />
                        <div class="avatar-overlay">
                            <mat-icon>photo_camera</mat-icon>
                        </div>
                    </div>
                    <div class="category-badge">
                        <span>Catégorie</span>
                    </div>
                </div>

                <div class="card-content">
                    <h3 class="category-name">{{ cat.name }}</h3>
                    <p class="category-description">{{ cat.description || 'Aucune description' }}</p>
                </div>

                <div class="card-actions">
                    <button class="action-btn edit-btn" (click)="edit(cat)" matTooltip="Modifier la catégorie">
                        <mat-icon>edit</mat-icon>
                    </button>
                    <button class="action-btn delete-btn" (click)="delete(cat)" matTooltip="Supprimer la catégorie">
                        <mat-icon>delete</mat-icon>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Category Form Modal -->
    <div *ngIf="showForm" class="form-modal-overlay" (click)="closeForm()">
        <div class="form-modal" (click)="$event.stopPropagation()">
            <div class="form-header">
                <div class="form-title-section">
                    <mat-icon class="form-icon">{{ editingCategory ? 'edit' : 'add' }}</mat-icon>
                    <h2>{{ editingCategory ? 'Modifier la Catégorie' : 'Nouvelle Catégorie' }}</h2>
                </div>
                <button class="close-btn" (click)="closeForm()">
                    <mat-icon>close</mat-icon>
                </button>
            </div>

            <form [formGroup]="form" (ngSubmit)="submit()" class="category-form">
                <div class="form-content">
                    <!-- Category Name -->
                    <div class="form-field">
                        <label class="field-label">
                            <mat-icon>label</mat-icon>
                            Nom de la catégorie *
                        </label>
                        <mat-form-field appearance="outline" class="full-width">
                            <mat-label>Nom de la catégorie</mat-label>
                            <input matInput formControlName="name" placeholder="ex: Plats principaux" required />
                            <mat-error *ngIf="form.get('name')?.hasError('required')">
                                Le nom de la catégorie est requis
                            </mat-error>
                        </mat-form-field>
                    </div>

                    <!-- Category Description -->
                    <div class="form-field">
                        <label class="field-label">
                            <mat-icon>description</mat-icon>
                            Description
                        </label>
                        <mat-form-field appearance="outline" class="full-width">
                            <mat-label>Description de la catégorie</mat-label>
                            <textarea matInput formControlName="description" placeholder="Décrivez cette catégorie..." rows="3"></textarea>
                        </mat-form-field>
                    </div>

                    <!-- Image Upload -->
                    <div class="form-field">
                        <label class="field-label">
                            <mat-icon>image</mat-icon>
                            Image de la catégorie
                        </label>
                        <div class="image-upload-section">
                            <div class="current-image" *ngIf="form.value.imageBase64">
                                <img [src]="form.value.imageBase64" alt="Image de catégorie" />
                                <button type="button" class="remove-image-btn" (click)="removeImage()" matTooltip="Supprimer l'image">
                                    <mat-icon>close</mat-icon>
                                </button>
                            </div>

                            <div class="upload-area" *ngIf="!form.value.imageBase64">
                                <input id="categoryImageUpload" type="file" accept="image/*" (change)="onImageSelected($event)" class="hidden-input">
                                <label for="categoryImageUpload" class="upload-label">
                                    <mat-icon class="upload-icon">cloud_upload</mat-icon>
                                    <span class="upload-text">Cliquez pour ajouter une image</span>
                                    <span class="upload-hint">PNG, JPG jusqu'à 5MB</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="cancel-btn" (click)="closeForm()">
                        <mat-icon>close</mat-icon>
                        Annuler
                    </button>
                    <button type="submit" class="submit-btn" [disabled]="form.invalid || isSubmitting">
                        <mat-icon *ngIf="!isSubmitting">{{ editingCategory ? 'save' : 'add' }}</mat-icon>
                        <mat-spinner *ngIf="isSubmitting" diameter="20"></mat-spinner>
                        {{ isSubmitting ? 'Enregistrement...' : (editingCategory ? 'Mettre à jour' : 'Créer') }}
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>